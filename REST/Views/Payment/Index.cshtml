@{
    ViewData["Title"] = "Payment";
    Layout = "_LayoutStoreFront";

    var Id = ViewBag.TableId;
    var Data = ViewBag.OrderSub;

    decimal TotalPrice = 0;

    foreach (var Price in Data)
    {
        TotalPrice += Price.Price;
    }
}

@section Styles {
    <link rel="stylesheet" href="~/StyleSheet/Payment/Index.css" />
    <link rel="stylesheet" href="~/Plugins/SlimScroll-1.3.8/libs/prettify/prettify.css" />
}

<div class="row mb-3 card__Hearder">
    <div class="col ">
        <div class="card border-0">
            <div class="card-body text-center">
                <h4 class="font-weight-bold mb-0 text-secondary">ข้อมูลโต๊ะอาหาร</h4>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-4 col-md-5 pr-md-0 mb-3">
        <div class="card border-0">
            <div class="card-body">
                <div class="payment__Hearder">
                    <h6 class="font-weight-bold text-secondary">ข้อมูลการชำระเงิน</h6>
                    <hr />
                </div>
                <div class="scroll__Payment">
                    <div class="row">
                        <div class="col">
                            <button class="btn btn-success-light btn-block" onclick="Payment('@Id')"><i class="fas fa-cash-register"></i>&nbsp;ชำระเงิน</button>
                        </div>
                    </div>
                    <hr />
                    <div class="row">
                        <div class="col">
                            <h6 class="text-left font-weight-bold text-secondary pt-2"><span>ราคาทั้งหมด ฿</span></h6>
                        </div>
                        <div class="col">
                            <input type="text" class="input__text text-right" placeholder="0.00" id="txtTotalPrice" value="@TotalPrice" disabled />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-8 col-md-7 Document__Payment">
        <div class="card border-0">
            <div class="card-body">
                <div class="order__Hearder mb-3">
                    <h6 class="font-weight-bold text-secondary">ข้อมูลรายการอาหาร</h6>
                </div>
                
                <div class="scroll__Order">

                    <table class="table table-hover sticky" id="TB_Table">
                        <thead class="thead-light">
                            <tr>
                                <th class="text-center">รหัสอาหาร</th>
                                <th class="text-center">ชื่ออาหาร</th>
                                <th class="text-center">จำนวน</th>
                                <th class="text-center">ราคา</th>
                                <th class="text-center">สถานะ</th>
                                <th class="text-center">ครั้งที่</th>
                                <th class="text-center">#</th>
                            </tr>
                        </thead>
                        <tbody id="TB_Body">

                        </tbody>
                    </table>

                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/Plugins/Numeral/numeral.js"></script>
    <script src="~/Plugins/SlimScroll-1.3.8/libs/prettify/prettify.js"></script>
    <script src="~/Plugins/SlimScroll-1.3.8/jquery.slimscroll.min.js"></script>
    <script>

        $(document).ready(function () {

            Scroll_Order()

            GetOrder('@Id')
        });

        // Get

        function GetOrder(v) {
            $('#TB_Body').empty();
            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetOrder", "Payment")',
                dataType: 'json',
                data: { id: v},
                success: function (data) {
                    $.each(data, function (index, val) {
                        if (val != "") {
                            val.forEach(function (value) {

                                // Evnt Click Delete
                                var HDelete = 'onclick=DeleteOrder("' + value.orderId + '","' + value.tableId + '","' + value.foodId + '");';

                                // Status Order
                                if (value.status == 0) {
                                    var st = '<td class="text-center" style="width:4rem;"><span class="badge badge-pill badge-warning" data-toggle="tooltip" data-placement="left" title="ยังไม่ได้ทำ"><i class="fas fa-not-equal"></i></span></td>'
                                } else if (value.status == 1) {
                                    var st = '<td class="text-center" style="width:4rem;"><span class="badge badge-pill badge-danger" data-toggle="tooltip" data-placement="left" title="กำลังดำเนินการ"><i class="fas fa-history"></i></span></td>'
                                } else if (value.status == 2) {
                                    var st = '<td class="text-center" style="width:4rem;"><span class="badge badge-pill badge-success" data-toggle="tooltip" data-placement="left" title="เสร็จแล้ว"><i class="fas fa-thumbs-up"></i></span></td>'
                                }

                                var t = '<tr>'
                                    + '<td>' + value.foodId + '</td>'
                                    + '<td>' + value.foodName + '</td>'
                                    + '<td class="text-center">' + value.amount + '</td>'
                                    + '<td class="text-right">' + numeral(value.price).format('0,0.00') + '</td>'                                
                                    + st
                                    + '<td class="text-center" style="width:4rem;">' + value.i + '</td>'
                                    + '<td class="text-center text-danger" style="width:2rem;"><a href="#" ' + HDelete +' class="text-danger"><i class="fas fa-trash-alt"></i></a></td>'
                                    + '</tr>';

                                $('#TB_Table').append(t)
                            })
                        } else {

                            var t = '<tr>'
                                + '<td colspan="7" class="text-center">ไม่มีข้อมูล</td>'
                                + '</tr>';

                            $('#TB_Table').append(t)
                        }

                    })

                }
            });
        }

        // Function

        function DeleteOrder(OrderId, TableId, FoodId) {
            Swal.fire({
                text: "ต้องการยกเลิกรายการหรือไม่ ?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes',
                cancelButtonText: 'No'
            }).then((result) => {
                if (result.value) {
                    $.ajax({
                        type: 'POST',
                        url: '@Url.Action("DeleteOrderPayment", "Order")',
                        dataType: 'json',
                        data: { OrderId: OrderId, TableId: TableId, FoodId: FoodId },
                        success: function (data) {
                            $.each(data, function (index, val) {
                                if (val == "success") {
                                    window.location.href = '@Url.Action("Index", "Payment")'
                                } else {
                                    window.location.href = '@Url.Action("Index", "StoreFront")'
                                }
                            })
                        }
                    });
                }
            });
        }

        function Payment(TableId) {
            Swal.fire({
                text: "ต้องการชำระเงินหรือไม่ ?",
                icon: 'info',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes',
                cancelButtonText: 'No'
            }).then((result) => {
                if (result.value) {
                    $.ajax({
                        type: 'POST',
                        url: '@Url.Action("Payment", "Payment")',
                        dataType: 'json',
                        data: { TableId: TableId },
                        success: function (data) {
                            $.each(data, function (index, val) {
                                if (val == "success") {
                                    window.location.href = '@Url.Action("Index", "StoreFront")'
                                }
                            })
                        }
                    });
                }
            });
        }

        // Resize

        function Scroll_Order() {

            var height_Payment = $(document).height() - $('.payment__Hearder').height() - $('.card__Hearder').height() - $('.navbar').height() - 70 - 56

            var height_Order = $(document).height() - $('.order__Hearder').height() - $('.card__Hearder').height() - $('.navbar').height() - 70 - 56

            $('.scroll__Payment').slimScroll({
                height: height_Payment
            });

            $('.scroll__Order').slimScroll({
                height: height_Order
            });

            console.log(height_Order);

        }

    </script>
}