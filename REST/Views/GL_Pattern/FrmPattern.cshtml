@{
    ViewData["Title"] = "รูปแบบบัญชี";
    ViewData["System"] = "รูปแบบบัญชี";
    Layout = "_Manage";
}

<div class="card">
    <div class="card-body">
        <!-- Form -->
        <section>
            <div class="row">
                <div class="col-xl-11 mx-auto">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group row">
                                <label class="col-xl-4 col-sm-5 text-sm-right col-form-label col-form-label-sm">รูปแบบบัญชี :</label>
                                <div class="col-xl-8 col-sm-7">
                                    <select id="txtDesCription" class="form-control form-control-sm">
                                        <option value="1">รายการรับเงิน</option>
                                        <option value="2">รายการจ่ายเงิน</option>
                                        <option value="3">รายการขาย</option>
                                        <option value="4">รายการซื้อ</option>
                                        <option value="5">รายการปรับปรุง</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group row">
                                <label class="col-xl-4 col-sm-5 text-sm-right col-form-label col-form-label-sm">สมุดรายวัน :</label>
                                <div class="col-xl-8 col-sm-7">
                                    <select id="txtAccountBook" class="form-control form-control-sm">
                                        @{
                                            foreach (var row in ViewBag.AccountBook)
                                            {
                                                <option value="@row.BookId">@row.BookId : @row.BookName</option>
                                            }
                                        }
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group row">
                                <label class="col-xl-4 col-sm-5 text-sm-right col-form-label col-form-label-sm">รหัสรูปแบบ :</label>
                                <div class="col-xl-8 col-sm-7">
                                    <input id="txtM_ID" type="text" class="form-control form-control-sm">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group row">
                                <label class="col-xl-4 col-sm-5 text-sm-right col-form-label col-form-label-sm">ชื่อรูปแบบ :</label>
                                <div class="col-xl-8 col-sm-7">
                                    <input id="txtM_Name" type="text" class="form-control form-control-sm">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xl-8 col-lg-10 col-md-10">
                            <div class="form-group row">
                                <label class="col-xl-3 col-lg-3 col-md-3 col-sm-5 text-sm-right col-form-label col-form-label-sm"></label>
                                <div class="col-xl-9 col-sm-7">
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="M_PType" id="M_PType1" value="1" checked>
                                        <label class="form-check-label col-form-label-sm" for="M_PType1">คิดเป็นเปอร์เซ็นต์</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="M_PType" id="M_PType2" value="2">
                                        <label class="form-check-label col-form-label-sm" for="M_PType2">กำหนดจำนวนเงินเอง</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xl-8 col-lg-10 col-md-10">
                            <div class="form-group row">
                                <label class="col-xl-3 col-lg-3 col-md-3 col-sm-5 text-sm-right col-form-label col-form-label-sm"></label>
                                <div class="col-xl-9 col-sm-7">
                                    <div class="form-row align-items-center">
                                        <div class="col-auto">
                                            <div class="form-check">
                                                <input id="CHSystem" class="form-check-input mt-2" type="checkbox" name="Bch">
                                                <label class="form-check-label col-form-label-sm" for="CHSystem">
                                                    ใช้งานกับระบบอื่น
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <select id="txtSystem" class="form-control form-control-sm">
                                                <option value="" selected>--เลือกระบบ--</option>
                                                <option value="ชำระเงิน">ชำระเงิน</option>
                                                <option value="สั่งซื้อ">สั่งซื้อ</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- Table -->
        <section>
            <div class="card border-0">
                <div class="card-body table-responsive p-0" scroll>
                    <table class="table table-md table-bordered table-head-fixed" id="DataTable">
                        <thead class="thead-primary-light">
                            <tr>
                                <th class="text-center">ผังบัญชี</th>
                                <th class="text-center">ชื่อผังบัญชี</th>
                                <th class="text-center" style="width:15%;">เดบิต</th>
                                <th class="text-center" style="width:15%">เครดิต</th>
                                <th class="text-center" style="width:5%;"> </th>
                            </tr>
                        </thead>
                        <tbody id="bodyt">
                            <tr id="NoResults">
                                <td class="text-center text-danger" colspan="5">ไม่มีรายการ</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <span><a href="#" class="text-primary col-form-label-sm" data-toggle="ajax-modal" data-target="#popupAccountChart" data-url="@Url.Action("_popupAccountChart", "Modal")">เพิ่มรายการ</a></span>
        </section>
        <!-- Footer -->
        <section>
            <div class="d-flex justify-content-center mt-3">
                <a href="#" class="btn btn-sm btn-blue mr-3 @ViewData["Disible-save"]"  btn-save><i class="far fa-save"></i>&nbsp;&nbsp;บันทึก</a>
                <a href="#" class="btn btn-sm btn-danger @ViewData["Disible-delete"]" btn-delete><i class="far fa-trash-alt"></i>&nbsp;&nbsp;ลบ</a>
            </div>
        </section>
    </div>
</div>

<div id="PlaceHolderHere"></div>

@section Scripts {
    <script src="~/Plugins/Numeral/numeral.js"></script>
    <script>
        $(document).ready(function () {
            SelectDesCription()
            CheckSystem()
        });

        document.getElementById("CHSystem").addEventListener("click", () => {
            CheckSystem()
        })

        document.getElementById("txtDesCription").addEventListener("click", () => {
            SelectDesCription()
        })

        function CheckSystem() {
            if ($('#CHSystem').prop("checked") == true) {
                $('#txtSystem').prop("disabled", false)
            } else {
                $('#txtSystem').prop("disabled", true)
            }
        }

        function SelectDesCription() {
            if ($('#txtDesCription').val() == '1') {
                $('#txtAccountBook').val('02')
            } else if ($('#txtDesCription').val() == '2') {
                $('#txtAccountBook').val('03')
            } else if ($('#txtDesCription').val() == '3') {
                $('#txtAccountBook').val('04')
            } else if ($('#txtDesCription').val() == '4') {
                $('#txtAccountBook').val('05')
            } else if ($('#txtDesCription').val() == '5') {
                $('#txtAccountBook').val('01')
            }
        }

        var PlaceHolderElement = $('#PlaceHolderHere')
        $('a[data-toggle="ajax-modal"]').click(function (event) {
            var url = $(this).data('url')
            $.get(url).done(function (data) {
                PlaceHolderElement.html(data)
                PlaceHolderElement.find('.modal').modal('show')
            })
        })

        $(document).on('keypress ', '.numberonly', function () {
            const e = event.keyCode
            if (e >= 48 && e <= 57 || e === 8 || e === 13 || e === 46) {
                event.returnValue = true
            } else {
                Swal.fire({ text: "สามารถกดได้แค่ตัวเลข", icon: 'warning' })
                event.returnValue = false
            }
        })

        $(document).on('blur ', '.numberonly', function () {
            const number = $(this).val()
            $(this).val(numeral(number).format('0,0.00'))
        })

        function showAccountChart(id) {

            $('#NoResults').remove();

            $.get("@Url.Action("GetView", "api")" + "/AShowAccountChart", { id: id },
                function (data, status) {

                    var rowItem = `<tr>`
                        + `<td>${data.accNo}</td>`
                        + `<td>${data.accName}</td>`
                        + `<td>`
                        + `<input type="text" class="form-control-plaintext form-table-control-sm text-right numberonly" placeholder="0.00" >`
                        + `</td>`
                        + `<td>`
                        + `<input type="text" class="form-control-plaintext form-table-control-sm text-right numberonly" placeholder="0.00" >`
                        + `</td>`
                        + `<td class="text-center"><a href="#" id="remove" class="text-danger">ลบ</a></td>`
                        + `</tr>`;
                    $("#bodyt").append(rowItem)
                }
            )

            $('#popupAccountChart').modal('hide')
        }

        // Remove
        $('body').on('click', '#remove', function () {
            $(this).parents('tr').remove();

            var tbody = document.getElementById('bodyt')

            if (tbody.rows.length === 0) {
                var t = '<tr id="NoResults">'
                    + '<td class="text-center text-danger" colspan="5">ไม่มีรายการ</td>'
                    + '</tr>';
                $('#bodyt').append(t)
            }
        })

        document.querySelector("[btn-save]").addEventListener('click', () => {
             Swal.fire({
                text: "ต้องการบันทึกข้อมูลหรือไม่ ?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes',
                cancelButtonText: 'No'
            }).then((result) => {
                if (result.value) {

                }
            })
        })

        document.querySelector("[btn-delete]").addEventListener('click', () => {
             Swal.fire({
                text: "ต้องการลบข้อมูลหรือไม่ ?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes',
                cancelButtonText: 'No'
            }).then((result) => {
                if (result.value) {

                }
            })
        })
    </script>
}